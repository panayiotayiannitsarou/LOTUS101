import pandas as pd
import itertools
from collections import Counter

# -----------------------------
# Î’Î®Î¼Î± 1 â€“ ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î Î±Î¹Î´Î¹ÏÎ½ Î•ÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏÎ½
# -----------------------------

# ğŸ“Œ Î‘Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· ÎœÎ±Î¸Î·Ï„ÏÎ½:
# â€¢ Î•Ï€Î¹Î»Î­Î³Î¿Î½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Î¼Î±Î¸Î·Ï„Î­Ï‚ Î¼Îµ Ï„Î¹Î¼Î® Î ÏƒÏ„Î· ÏƒÏ„Î®Î»Î· Î Î‘Î™Î”Î™_Î•ÎšÎ Î‘Î™Î”Î•Î¥Î¤Î™ÎšÎŸÎ¥.

# ğŸ”¹ ÎšÎ±Î½ÏŒÎ½Î±Ï‚ 1 â€“ ÎŒÏ„Î±Î½ Î¿ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Ï€Î±Î¹Î´Î¹ÏÎ½ â‰¤ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Ï„Î¼Î·Î¼Î¬Ï„Ï‰Î½:
# ğŸ“Œ Î£Ï„ÏŒÏ‡Î¿Ï‚: Î— ÏŒÏƒÎ¿ Ï„Î¿ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î¹ÏƒÏŒÏ€Î¿ÏƒÎ· ÎºÎ±Ï„Î±Î½Î¿Î¼Î® Ï„Ï‰Î½ Ï€Î±Î¹Î´Î¹ÏÎ½ ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏÎ½ ÏƒÏ„Î± Ï„Î¼Î®Î¼Î±Ï„Î±.
# â€¢ Î¤Î¿Ï€Î¿Î¸ÎµÏ„ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ Ï€Î¿Î»Ï Î­Î½Î± Ï€Î±Î¹Î´Î¯ ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÎ¿Ï Î±Î½Î¬ Ï„Î¼Î®Î¼Î±.
# â€¢ Î— Ï„Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ· Î³Î¯Î½ÎµÏ„Î±Î¹ Î¼Îµ ÏƒÎµÎ¹ÏÎ¬, Ï‡Ï‰ÏÎ¯Ï‚ Î¬Î»Î»ÎµÏ‚ Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„ÎµÏ‚.
# â€¢ Î— Ï„Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ· Ï„Ï‰Î½ Ï€Î±Î¹Î´Î¹ÏÎ½ ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏÎ½ Î³Î¯Î½ÎµÏ„Î±Î¹ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ ÏƒÏ„Î· ÏƒÏ„Î®Î»Î· Î Î¡ÎŸÎ¤Î•Î™ÎÎŸÎœÎ•ÎÎŸ_Î¤ÎœÎ—ÎœÎ‘.
# â€¢ ÎŸÎ¹ Î¼Î±Î¸Î·Ï„Î­Ï‚ Î±Ï…Ï„Î¿Î¯ Î¼Î±ÏÎºÎ¬ÏÎ¿Î½Ï„Î±Î¹ Ï‰Ï‚ ÎºÎ»ÎµÎ¹Î´Ï‰Î¼Î­Î½Î¿Î¹ (ÎšÎ›Î•Î™Î”Î©ÎœÎ•ÎÎŸÎ£ = True).
# â€¢ Î— Ï†Î¹Î»Î¯Î± Î¸ÎµÏ‰ÏÎµÎ¯Ï„Î±Î¹ Ï€Î»Î®ÏÏ‰Ï‚ Î±Î¼Î¿Î¹Î²Î±Î¯Î± Î¼ÏŒÎ½Î¿ Î±Î½ ÎºÎ±Î¹ Î¿Î¹ Î´ÏÎ¿ Î¼Î±Î¸Î·Ï„Î­Ï‚ Î­Ï‡Î¿Ï…Î½ Î´Î·Î»ÏÏƒÎµÎ¹ Î¿ Î­Î½Î±Ï‚ Ï„Î¿Î½ Î¬Î»Î»Î¿Î½.

# ğŸ”¹ ÎšÎ±Î½ÏŒÎ½Î±Ï‚ 2 â€“ ÎŒÏ„Î±Î½ Î¿ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Ï€Î±Î¹Î´Î¹ÏÎ½ > Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Ï„Î¼Î·Î¼Î¬Ï„Ï‰Î½:
# ğŸ“Œ Î£Ï„ÏŒÏ‡Î¿Ï‚: Î— ÏŒÏƒÎ¿ Ï„Î¿ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î¹ÏƒÏŒÏ€Î¿ÏƒÎ· ÎºÎ±Ï„Î±Î½Î¿Î¼Î® Ï„Ï‰Î½ Ï€Î±Î¹Î´Î¹ÏÎ½ ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏÎ½ ÏƒÏ„Î± Ï„Î¼Î®Î¼Î±Ï„Î±.
# â€¢ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½Ï„Î±Î¹ ÎµÎ½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ¬ ÏƒÎµÎ½Î¬ÏÎ¹Î± ÎºÎ±Ï„Î±Î½Î¿Î¼Î®Ï‚, Ï„Î± Î¿Ï€Î¿Î¯Î± ÎµÏ†Î±ÏÎ¼ÏŒÎ¶Î¿Ï…Î½ Ï„Î¿Ï…Ï‚ ÎµÎ¾Î®Ï‚ ÎºÎ±Î½ÏŒÎ½ÎµÏ‚ Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±Ï‚:
#   1ï¸âƒ£ Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· Ï€Î»Î®ÏÏ‰Ï‚ Î±Î¼Î¿Î¹Î²Î±Î¯Î±Ï‚ Ï†Î¹Î»Î¯Î±Ï‚ Î¼ÎµÏ„Î±Î¾Ï Ï€Î±Î¹Î´Î¹ÏÎ½ ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏÎ½ (Î¹ÏƒÏ‡ÏÎµÎ¹ Î¼ÏŒÎ½Î¿ Î³Î¹Î± Î´Ï…Î¬Î´Î± Ï€Î¿Ï… Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¼Ï€Î¿Ï…Î½ Î¼Î±Î¶Î¯).
#   2ï¸âƒ£ Î‘Ï€Î¿Ï†Ï…Î³Î® ÏƒÏ…Î³ÎºÎ­Î½Ï„ÏÏ‰ÏƒÎ·Ï‚ Î¯Î´Î¹Î¿Ï… Ï†ÏÎ»Î¿Ï….
# â¤ Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï€Î»Î®ÏÏ‰Ï‚ Î±Î¼Î¿Î¹Î²Î±Î¯Î± Ï†Î¹Î»Î¯Î±, ÎµÏ€Î¹Î»Î­Î³ÎµÏ„Î±Î¹ Ï„Î¼Î®Î¼Î± Î¼Îµ:
# â€¢ Î¤Î¿Î½ Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿ Î±ÏÎ¹Î¸Î¼ÏŒ Ï€Î±Î¹Î´Î¹ÏÎ½ ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏÎ½.
# â€¢ Î¤Î· Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ· ÏƒÏ…Î³ÎºÎ­Î½Ï„ÏÏ‰ÏƒÎ· Ï„Î¿Ï… Î¯Î´Î¹Î¿Ï… Ï†ÏÎ»Î¿Ï… Î¼Îµ Ï„Î¿ Ï€Î±Î¹Î´Î¯ Ï€Î¿Ï… ÎµÎ¾ÎµÏ„Î¬Î¶ÎµÏ„Î±Î¹.
# â€¢ Î— Ï„Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ· Ï„Ï‰Î½ Ï€Î±Î¹Î´Î¹ÏÎ½ ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏÎ½ Î³Î¯Î½ÎµÏ„Î±Î¹ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ ÏƒÏ„Î· ÏƒÏ„Î®Î»Î· Î Î¡ÎŸÎ¤Î•Î™ÎÎŸÎœÎ•ÎÎŸ_Î¤ÎœÎ—ÎœÎ‘.
# â€¢ ÎŸÎ¹ Î¼Î±Î¸Î·Ï„Î­Ï‚ Î±Ï…Ï„Î¿Î¯ Î¼Î±ÏÎºÎ¬ÏÎ¿Î½Ï„Î±Î¹ Ï‰Ï‚ ÎºÎ»ÎµÎ¹Î´Ï‰Î¼Î­Î½Î¿Î¹ (ÎšÎ›Î•Î™Î”Î©ÎœÎ•ÎÎŸÎ£ = True).
# â€¢ Î— Ï†Î¹Î»Î¯Î± Î¸ÎµÏ‰ÏÎµÎ¯Ï„Î±Î¹ Ï€Î»Î®ÏÏ‰Ï‚ Î±Î¼Î¿Î¹Î²Î±Î¯Î± Î¼ÏŒÎ½Î¿ Î±Î½ ÎºÎ±Î¹ Î¿Î¹ Î´ÏÎ¿ Î¼Î±Î¸Î·Ï„Î­Ï‚ Î­Ï‡Î¿Ï…Î½ Î´Î·Î»ÏÏƒÎµÎ¹ Î¿ Î­Î½Î±Ï‚ Ï„Î¿Î½ Î¬Î»Î»Î¿Î½.

# ğŸ§  Î“ÎµÎ½Î¹ÎºÏŒÏ‚ ÎšÎ±Î½ÏŒÎ½Î±Ï‚ ÎšÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î•Î½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÏÎ½ Î£ÎµÎ½Î±ÏÎ¯Ï‰Î½ (Î’Î®Î¼Î± 1)
# â€¢ ÎŒÏ„Î±Î½ ÎµÎ¾ÎµÏ„Î¬Î¶Î¿Î½Ï„Î±Î¹ ÎµÎ½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ¬ ÏƒÎµÎ½Î¬ÏÎ¹Î± ÎºÎ±Ï„Î±Î½Î¿Î¼Î®Ï‚ Ï€Î±Î¹Î´Î¹ÏÎ½ ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏÎ½,
# ÎºÏÎ±Ï„Î¿ÏÎ½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Ï„Î± Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¬ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¬ ÏƒÎµÎ½Î¬ÏÎ¹Î±. Î‘Î½ Ï„Î± ÏƒÏÎ½Î¿Î»Î± Î¼Î±Î¸Î·Ï„ÏÎ½
# Î±Î½Î¬ Ï„Î¼Î®Î¼Î± ÎµÎ¯Î½Î±Î¹ Î¯Î´Î¹Î± Î±Î½ÎµÎ¾Î±ÏÏ„Î®Ï„Ï‰Ï‚ Î¿Î½ÏŒÎ¼Î±Ï„Î¿Ï‚ (Î‘1/Î‘2), Ï„ÏŒÏ„Îµ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ ÎµÎ¯Î½Î±Î¹
# ÎµÏ€Î±Î½Î±Î»Î±Î¼Î²Î±Î½ÏŒÎ¼ÎµÎ½Î¿ ÎºÎ±Î¹ Î±Ï€Î¿ÏÏÎ¯Ï€Ï„ÎµÏ„Î±Î¹.

# ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± Ï„Î¿ Î±Î½ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î· Î±Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ· Î¹ÏƒÎ¿ÏÏÎ¿Ï€Î¯Î±Ï‚ Ï†ÏÎ»Î¿Ï…
# (Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ Î¼ÏŒÎ½Î¿ Î±Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Î¹ Î±Î³ÏŒÏÎ¹Î± ÎºÎ±Î¹ ÎºÎ¿ÏÎ¯Ï„ÏƒÎ¹Î±)
genders_all = set(df[df['Î Î‘Î™Î”Î™_Î•ÎšÎ Î‘Î™Î”Î•Î¥Î¤Î™ÎšÎŸÎ¥'] == 'Î']['Î¦Î¥Î›ÎŸ'])
enable_gender_balance_check = len(genders_all) > 1

# ÎœÎµÏ„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ ÏƒÎµÎ½Î±ÏÎ¯Ï‰Î½ (valid_senarios)
# Î•Î»Î­Î³Ï‡Î¿Ï…Î¼Îµ Î±Î½ ÎºÎ¬Ï€Î¿Î¹Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Î­Ï‡ÎµÎ¹ Ï„Î¼Î®Î¼Î± Î¼Îµ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î¼Î±Î¸Î·Ï„Î­Ï‚ Î¯Î´Î¹Î¿Ï… Ï†ÏÎ»Î¿Ï…
scenario_labels = []
for scenario in valid_senarios:
    label = ''
    if enable_gender_balance_check:
        for tmhma in scenario.values():
            genders = [df[df['ÎŸÎÎŸÎœÎ‘Î¤Î•Î Î©ÎÎ¥ÎœÎŸ'] == name]['Î¦Î¥Î›ÎŸ'].values[0] for name in tmhma]
            if len(set(genders)) == 1 and len(genders) > 1:
                label = 'âš  Î Î¹Î¸Î±Î½Î® Î±Î½Î¹ÏƒÎ¿ÏÏÎ¿Ï€Î¯Î± Ï†ÏÎ»Î¿Ï…'
                break
    scenario_labels.append(label)

# Î¤Î± ÏƒÎµÎ½Î¬ÏÎ¹Î± Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ ÏƒÎ®Î¼Î±Î½ÏƒÎ· "âš " Ï„Î¿Ï€Î¿Î¸ÎµÏ„Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ Ï„Î·Ï‚ Î»Î¯ÏƒÏ„Î±Ï‚
scenarios_with_labels = list(zip(valid_senarios, scenario_labels))
scenarios_with_labels.sort(key=lambda x: x[1] == 'âš  Î Î¹Î¸Î±Î½Î® Î±Î½Î¹ÏƒÎ¿ÏÏÎ¿Ï€Î¯Î± Ï†ÏÎ»Î¿Ï…')

# ÎÎµÏ‡Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï„Î± ÏƒÎµÎ½Î¬ÏÎ¹Î± ÎºÎ±Î¹ Ï„Î¹Ï‚ ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ Ï„Î¿Ï…Ï‚
valid_senarios, scenario_labels = zip(*scenarios_with_labels)
valid_senarios = list(valid_senarios)
scenario_labels = list(scenario_labels)

# Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†Î¿Ï…Î¼Îµ Ï„Î± Ï„Î±Î¾Î¹Î½Î¿Î¼Î·Î¼Î­Î½Î± ÏƒÎµÎ½Î¬ÏÎ¹Î± Î¼Îµ Ï„Î·Î½ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î· ÏƒÎ®Î¼Î±Î½ÏƒÎ·
